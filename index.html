<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Fedelesh Petals</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Montserrat', sans-serif; margin: 0; padding: 20px; text-align: center; }
        
        /* –°—Ç–∏–ª—å –¥–ª—è –ø–æ–º–∏–ª–∫–∏ */
        #error-box {
            display: none;
            background: #ffebee;
            color: #c62828;
            padding: 15px;
            border-radius: 10px;
            border: 1px solid #ef5350;
            margin-top: 20px;
            text-align: left;
            font-size: 14px;
            white-space: pre-wrap;
        }

        /* –°—Ç–∏–ª—å –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è */
        #loader { font-size: 18px; color: #555; margin-top: 50px; }

        /* –°—Ç–∏–ª—å –∫–∞—Ä—Ç–æ–∫ (—è–∫—â–æ –∑–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç—å—Å—è) */
        .grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; text-align: left; }
        .card { border: 1px solid #eee; border-radius: 10px; padding: 10px; }
        img { width: 100%; height: 100px; object-fit: cover; border-radius: 5px; }
    </style>
</head>
<body>

    <h2>Fedelesh Petals üå∏</h2>
    
    <div id="loader">‚è≥ –ü—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è –¥–æ –±–∞–∑–∏...</div>
    <div id="error-box"></div>
    <div id="product-list" class="grid"></div>

    <script>
        const tg = window.Telegram.WebApp;
        tg.expand();

        // –¢–í–û–á –î–ê–ù–Ü (–í–∂–µ –ø—Ä–∞–≤–∏–ª—å–Ω—ñ)
        const SUPABASE_URL = 'https://qgdnvpmdfqsgtftfkcrm.supabase.co';
        const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InFnZG52cG1kZnFzZ3RmdGZrY3JtIiwicm9sZSI6ImFub24iLCJpYXQiOjE3Njc4MTY0MDUsImV4cCI6MjA4MzM5MjQwNX0.YF4VlFg4PuiagvWh_LKxaBinKjtrtgjYDfaO3ZYuRBY';

        async function init() {
            try {
                // 1. –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –±—ñ–±–ª—ñ–æ—Ç–µ–∫–∏
                if (!window.supabase) throw new Error("Supabase JS –Ω–µ –∑–∞–≤–∞–Ω—Ç–∞–∂–∏–≤—Å—è. –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ —ñ–Ω—Ç–µ—Ä–Ω–µ—Ç.");

                const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

                // 2. –°–ø—Ä–æ–±–∞ –≤–∑—è—Ç–∏ –¥–∞–Ω—ñ
                const { data, error } = await supabase.from('products').select('*');

                if (error) throw error; // –Ø–∫—â–æ –ø–æ–º–∏–ª–∫–∞ –±–∞–∑–∏ - –∫–∏–¥–∞—î–º–æ —ó—ó –≤ catch

                if (!data || data.length === 0) {
                    throw new Error("–ë–∞–∑–∞ –¥–∞–Ω–∏—Ö –ø–æ—Ä–æ–∂–Ω—è (0 —Ç–æ–≤–∞—Ä—ñ–≤). –î–æ–¥–∞–π—Ç–µ —Ç–æ–≤–∞—Ä–∏ —á–µ—Ä–µ–∑ SQL.");
                }

                // 3. –Ø–∫—â–æ –≤—Å–µ –æ–∫ - –º–∞–ª—é—î–º–æ —Ç–æ–≤–∞—Ä–∏
                document.getElementById('loader').style.display = 'none';
                const list = document.getElementById('product-list');
                
                data.forEach(p => {
                    list.innerHTML += `
                        <div class="card">
                            <img src="${p.image_url}" onerror="this.src='https://via.placeholder.com/150'">
                            <div><b>${p.name}</b></div>
                            <div>${p.price} –≥—Ä–Ω</div>
                        </div>`;
                });

            } catch (err) {
                // –ü–û–ö–ê–ó–£–Ñ–ú–û –ü–û–ú–ò–õ–ö–£ –ù–ê –ï–ö–†–ê–ù–Ü
                document.getElementById('loader').style.display = 'none';
                const box = document.getElementById('error-box');
                box.style.display = 'block';
                box.innerHTML = `‚ùå <b>–ü–û–ú–ò–õ–ö–ê:</b>\n${err.message}\n\nCode: ${err.code || 'N/A'}\nHint: ${err.hint || 'N/A'}`;
            }
        }

        init();
    </script>
</body>
</html>
